# PharmApi.ru: подключение по протоколу Астра-Зенека (Лайк-Фарма)

## Общая информация

За основу взята оригинальная документация, опубликованная на [astrazeneca.like-pharma.com](https://astrazeneca.like-pharma.com/api/documentation/), из неё реализованы методы: 

  * register
  * confirm_code
  * get_discount
  * confirm_purchase
  * get_products
  * get_programs
  * cancel_purchase
  
Описание этих методов сюда не копируется, пожалуйста используйте исходный документ.

## Порядок подключения

  1. Имя сервера (hostname) выделяется каждому партнеру в начале интеграции;
  2. Тестовые значения `authorization-token` и `authorization-secret` выделяются каждому партнеру в начале интеграции;
  3. Боевые значения  `authorization-token` и `authorization-secret` выделяются каждому партнеру после успешного завершения интеграции, перед запуском проекта.


## Отличия от оригинального протокола

### 1. Кодировка данных

Каждый сервер имеет два endpoint-а для обмена данными: 

 * `https://{hostname}/api/v1.0/` - запросы и ответы передаются в теле запроса в JSON
 * `https://{hostname}/api/v1.0-encoded/` - запросы и ответы передаются в теле запроса в JSON, кодированном с помощью urlencode 

Использовать можно любой из двух endpoint-ов.


### 2. HTTPS

Обмен данными возможен только по протоколу HTTPS (обычный HTTP не поддерживается). Проверка сертификата сервера от клиента не требуется.

Обмен данными следует выполнять по hostname: использование IP-адреса не приветствуется, так как IP может меняться со временем.


### 3. Указание `pharmacy_id` вместе с `pos_id` 

Во всех запросах где присутствует параметр `pos_id` очень желательно указывать код аптеки (`pharmacy_id`) - это снизит требования к частоте передачи данных об аптеках. Сервер, в этом случае, будет указывать тот же параметр `pharmacy_id` в ответах.

