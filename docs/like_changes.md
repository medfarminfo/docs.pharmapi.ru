# Отличия от протокола Лайк-Фарма :id=differencies


## Методы `register` и `confirm_code`  :id=register

!>  По состоянию на апрель 2020 года нет ни одной программы, где бы использовалась регистрация карты на кассе в аптеке. На вызовы `register` и `confirm_code` сервер на данный момент отвечает фиксированным отрицательным ответом.


## Указание `pharmacy_id` вместе с `pos_id`  :id=pharmacy_id

Во всех запросах где присутствует параметр `pos_id` очень желательно указывать код аптеки (`pharmacy_id`) - это снизит требования к частоте передачи данных об аптеках. Сервер, в этом случае, будет указывать тот же параметр `pharmacy_id` в ответах.

При этом заполнение поля `pos_id` всё равно является обязательным (для возможности одновременного расчета скидки по двум разным чекам на двух разных кассах одной аптеки).

В случае если переданная в запросе комбинация значений `pos_id` и `pharmacy_id`  не соответствует ранее переданным данным по аптекам (т.е. указанное значение `pos_id` не присутствовало в списке аптек совсем, или же было подчинено другой аптеке), то значение `pharmacy_id` имеет приоритет.


## Указание `program` в ответе на `get_discount` :id=program-in-get-discount

Для облегчения привязки скидок к дисконтным программам в учетной системе аптеки при расчёте скидки сервер указывает по какой программе рассчитана скидка (соответствует полю `code` из ответа `get_programs`):

```json
{
  "pos_id": "1-234-567",
  "card_number": "1234567890050",
  "orders": [
    {
      "any_data": "row1",
      "barcode": "1111111111116",
      "count": 3,
      "description": "Наименование препарата",
      "discount": 466.2,
      "error_code": 0,
      "message": "Снижение цены рассчитано",
      "transaction": "e70774d1434b4acb905a81164db67c3c",
      "type": "percent",
      "value": 1864.8,
      "value_per_item": 621.6,
      "program": "test" //                   <<<--- новое поле
    }
  ],
  "status": "success",
  "error_code": 0,
  "message": "Снижение цены рассчитано"

}
```


## Множественное число в имени поля (`programs`) в ответе на `get_programs` :id=programs-in-get-programs

!> Применяется только начиная с [версии 1.1](connect.md#api-version-1-1). В более ранних версиях по-прежнему используется единственое число (`program`).

В ответе на запрос `get_programs` используется множественное число для имени поля (`programs`):

```json
{
  "programs": [
    {
      "code": "test",
      "name": "Тестовая программа для отладки протокола"
    }
  ],
  "status": "success",
  "error_code": 0,
  "message": "Список проектов сформирован"
}
```


## Передача информации об аптеках :id=pharmacies

В оригинальном протоколе передача данных об аптеках сети выполняется через отдельный FTP-сервер.

Однако для работы с PharmApi.ru сведения об аптеках нужно передавать прямо на основной сервер любым из двух способов: в виде JSON (метод [`update_pharmacies`](/methods/update_pharmacies.md)) или в виде XML (метод [`pl`](/methods/pl.md)).
