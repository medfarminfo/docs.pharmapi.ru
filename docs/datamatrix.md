# Маркировка, GTIN и DataMatrix

С осени 2020 года PharmApi поддерживает работу по кодам GTIN и данным маркировки (с кодов DataMatrix), в дополнение к работе по заводским штрихкодам (EAN13).

Для этих целей введено новое поле `qr_code` в запросах (и при необходимости ответах) методов [`get_discount`](/methods/get_discount), [`update_prices`](/methods/update_prieces), [`sellout`](/methods/sellout).

## Связь `barcode` и `qr_code`

В запросах (если в описании конкретного запроса не указано иное) следует заполнять или `barcode`, или `qr_code`. Если заполнены оба поля, то содержимое `qr_code` имеет приоритет (а значение `barcode` игнорируется, хотя и копируется в ответ).

В поле `barcode` следует указывать "**чистый**" код товара (EAN-13 или GTIN-14). А в поле `qr_code` следует указывать "**неразобранную**" строку с DataMatrix-кода (где обычно с третьей позиции находятся 14 символов GTIN-кода). 

При этом в рамках одного запроса допустимо **смешивать** заполнение полей - для одной строки указывать `barcode`, для другой `qr_code` и т.д. 

## Формат поля `qr_code`

В качестве значения для поля `qr_code` необходимо передавать строку, считанную с DataMatrix-кода упаковки.

Какие-либо преобразования считанной строки не требуются.

Допустимо отбрасывать крипто-параметры в конце строки (идентификаторы применения  91, 92 и т.п.), а можно их оставить (передавать в методы). Однако настоятельно НЕ рекомендуется обрезать (отбрасывать) какие-либо "значимые" идентификаторы применения (с кодом меньше 90), так как в будущем какая-либо дисконтная программа может потребовать передачи этих дополнительных данных.

Также **не** следует вырезать из строки непечатаемые символы-разделители (FNC1, &lt;GS&gt;, 0x1D и т.п.)

## Срочность обновления

На данный момент (декабрь 2020) нет никакой срочной необходимости обновлять ПО в аптеках для заполнения поля `qr_code` - сервера PharmApi успешно работают по значениям barcode, и нет планов "ломать" эту работоспособность.

Основной причиной перехода на использование нового поля могут быть лишь ваши собственные планы по "избавлению" от ведения/учета заводских ШК (EAN13) в вашей учетной системе.

Возможно в будущем появятся дисконтные программы, в которых будет требоваться заполнять `qr_code` для точного учета упаковок, но пока это поле необязательно для использования.