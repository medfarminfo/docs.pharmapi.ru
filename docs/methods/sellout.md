# Метод `sellout`

Используется для передачи сведений обо всех продажах акционных товаров: и тех что были проданы со скидкой в рамках дисконтной программы, и тем что были проданы без скидок (не участникам дисконтных программ).

За один вызов метода можно передать информацию сразу о нескольких разных продажах.

Оперативность передачи данных (максимально разрешенный срок передачи данных после факта продажи) регламентируется в договоре.


## Запрос :id=request

Метод запроса: `POST`

Тело запроса:

```json
{
  "data": [
    {
      "pharmacy_id": "<pharmacy_id>",
      "datetime": "<datetime>",
      "voucher_id": "<voucher_id>",
      "order_id": "<order_id>"
      "barcode":"<barcode>",
      "qr_code": "<qr_code>",
      "name":"<name>",
      "price": <price>,
      "count": <count>,
      "discount": <discount>,
      "sum_to_pay": <sum_to_pay>,
      "card_number": "<card_number>",
      "transaction": "<transaction>",
      "fn": "<fn>",
      "fd": "<fs>",
      "fpd": "<fpd>"
    },  
    ...
  ]
}
```

Одна строка (объект) - одна позиция в чеке.

Поля в запросе:

* `pharmacy_id` - текстовое, код аптеки (см. [`update_pharmacies`](update_pharmacies.md) и [`pl`](pl.md)) где была совершена продажа
* `datetime` - текстовое, дата и время совершения продажи, в формате ISO 8601, например `2020-03-05T16:59:57+03:00` для даты "5 марта 2020 года, время 16:59:57 в часовом поясе UTC+3ч (Москва)" 
* `voucher_id` - текстовое, идентификатор данного чека в БД аптеки,
* `order_id` - текстовое, номер/идентификатор строки чека
* `barcode` - текстовое, заводской ШК товара
* `qr_code` - текстовое, значение Data-Matrix кода упаковки
* `name` - текстовое, наименование товара (по БД аптеки)
* `price` - числовое (с десятичными разрядами), начальная цена единицы товара (потребительской упаковки)
* `count` - числовое (с десятичными разрядами), количество купленного товара (потребительских упаковок)
* `discount` - числовое (с десятичными разрядами), общая (суммарная) величина скидки по данной позиции чека в рублях
* `sum_to_pay` - числовое (с десятичными разрядами), сумма "к оплате" по данной позиции чека, считается по формуле `(price * count) - discount`
* `card_number` - текстовое, номер карты покупателя (если продажа была сделана по акции или по дисконтной программе)
* `transaction` - текстовое, код подтверждения транзакции (тот что передавался в [`confirm_transaction`](confirm_transaction.md))
* `fn` - текстовое, номер фискального накопителя (ФН №)
* `fd` - текстовое, номер фискального документа (ФД №)
* `fpd` - текстовое, фискальный признак документа (ФПД)

Должно быть заполнено хотя бы одно из двух полей `barcode` и `qr_code` (или оба сразу).

Поля `card_number` и `transaction` указываются только для тех продаж, которые были выполнены по дисконтной программе (были вызовы [`get_discount`](get_discount.md) и [`confirm_transaction`](confirm_transaction.md)).

Фискальные поля (`fn`, `fd`, `fpd`) должны быть либо все три заполнены, либо все три не заполнены.

Все остальные поля обязательны для заполнения.

Комбинация значений полей `pharmacy_id` + `voucher_id` + `order_id` должна быть уникальна в течение календарного года.


## Ответ :id=response

```json
{
    "status": "<status>",
    "error_code": <error_code>,
    "message": "<message>"
}
```

Поля в ответе:

  * `status` - текстовое, одно из двух значений: `success` (успех) или `error` (ошибка)
  * `error_code` - числовое, код ошибки (`0` если нет ошибок)
  * `message` - текстовое, сообщение описывающее значение error_code

Пример ответа:
```json
{
  "status": "success",
  "error_code": 0,
  "message": "12 продаж успешно приняты"
}
```