# Метод `update_prices`

Используется для передачи сведений об остатках и ценах в аптеках акционных товаров.

Можно передавать данные по всем аптекам сразу (одним запросом), можно передавать отдельные аптеки разными запросами, можно "группировать" несколько аптек в один запрос.

Нельзя передавать данные одной аптеки несколькими запросами - последний запрос затрёт данные предыдущего.

В случае если остатки какого-либо товара не переданы в запросе - считается что его остаток в аптеке равен нулю.

## Запрос :id=request

Метод запроса: `POST`

Тело запроса:

```json
{
  "prices":
  [
    {
      "pharmacy_id": "<pharmacy_id>",
      "barcode":"<barcode>",
      "qr_code":"<qr_code>",
      "lot": "<lot_id>",
      "name":"<name>",
      "price": <price>,
      "amount": <amount>,
    },  
    ...
  ]
}
```

Поля в запросе:

* `pharmacy_id` - код аптеки (см. [`update_pharmacies`](update_pharmacies.md) и [`pl`](pl.md)), данные которой передаются
* `barcode` - заводской ШК товара, строка, необязательное, см.ниже
* `qr_code` - значение DataMatrix кода на упаковке, строка, необязательное, см.ниже
* `lot` - идентификатор партии товара, строка, необязательное, см.ниже
* `name` - наименование товара (по БД аптеки), строка, обязательное
* `price` - цена единицы товара (потребительской упаковки), число, обязательное
* `amount` - количество единиц товара (потребительской упаковки) на остатке, число, обязательное

В случае если аптечная учетная система назначает одну и ту же цену на все партии (поступления от поставщиков) одного товара и НЕ учитывает остатки в разрезе datamatrix-кодов - необходимо передавать одну строку для товара, заполнить поле `barcode`, не заполнять поля `qr_code` и `lot`, а в `amount` указать суммарный остаток по всем поступлениям этого товара в данной аптеке. 

В случае если аптечная учетная система учитывает разные партии одного товара по отдельности, или же учитывает каждую упаковку отдельно согласно datamatrix-коду - нужна отдельная строка для каждой партии/упаковки товара, при этом необходимо заполнять или заполнять поля `barcode` или `lot`, или заполнить поле `qr_code` (в этом случае заполнение `barcode` и `lot` не проверяется).

Иными словами, необходимо чтобы в рамках одной аптеки комбинация значений полей `barcode`+`qr_code`+`lot` не повторялась.

Дополнтельные правила заполнения поля `qr_code` приведены в  разделе [Маркировка и DataMatrix](/datamatrix).

Разрешены дробные значения в полях `price` и `amount`.

Пример запроса:
```json
{
  "prices": [
    { "pharmacy_id": "12301", "barcode": "1234567890123", "name": "Фуфломицин 100мг №10", "amount": 77, "price": 123.45 },
    { "pharmacy_id": "12301", "barcode": "1234567890124", "name": "Фуфломицин 100мг №50", "amount": 20, "price": 1234 },
    { "pharmacy_id": "12302", "barcode": "1234567890123", "lot": "X2020N123-17", "name": "Фуфломицин 100мг №10", "amount": 7.3, "price": 120.11 },
    { "pharmacy_id": "12302", "barcode": "1234567890123", "lot": "X2020N124-19", "name": "Фуфломицин 100мг №10", "amount": 3, "price": 120.00 },
    { "pharmacy_id": "12302", "barcode": "1234567890124", "lot": "X2020N123-18", "name": "Фуфломицин 100мг №50", "amount": 10, "price": 1250 }
  ]
}

```


## Ответ :id=response

```json
{
    "status": "<status>",
    "error_code": <error_code>,
    "message": "<message>"
}
```

Поля в ответе:

  * `status` - текстовое, одно из двух значений: `success` (успех) или `error` (ошибка)
  * `error_code` - числовое, код ошибки (`0` если нет ошибок)
  * `message` - текстовое, сообщение описывающее значение error_code

Пример ответа:
```json
{
  "status": "success",
  "error_code": 0,
  "message": "Остатки и цены для 2 аптек успешно приняты"
}
```