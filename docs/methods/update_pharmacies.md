# Метод `update_pharmacies`

Используется для передачи сведений об аптеках в JSON-формате (для передачи в виде "старого" XML-файла используйте метод [`pl`](pl.md)).

Можно передавать все аптеки сразу (удобно для разовых загрузок), или по одной (или партиями) по мере изменения данных в основной учетной системе аптечной сети. 

## Запрос :id=request

Метод запроса: `POST`

Тело запроса:

```json
{
  "update_mode":"replace",
  "pharmacies":
  [
    { // минимально необходимые сведения об аптеке
      "id":"121",
      "address":"Москва, Центральная улица, дом 1",
      "pos_ids": [ "121-1", "121-2", "121-11" ],
    },  
    { // полный набор поддерживаемых полей
      "id":"123",
      "brand":"Супер-Аптека",
      "legal_entity": "ООО Супер-Аптека",
      "inn": "7700000000",
      "region":"Москва",
      "city":"Москва",
      "address":"Москва, Центральный переулок, дом 11",
      "gps":"55.55, 37.37",
      "work_time":"пт-сб 08-20",
      "phones":"8 (800) 000-00-00",
      "pos_ids": [ "123-1", "123-2", "123-11" ],
      "disabled":false,
      "hidden":false
    },
    ...
  ]
}
```

Поля в запросе:

* `update_mode` - режим обновления данных, допустимые значения: `merge` или `replace`, _обязательное поле_:
    * `merge` - "режим слияния": данные по переданным аптекам будут записаны поверх предыдущих данных тех же аптек, при этом данные по ранее переданным аптекам (не указанных в данном запросе) будут оставлены без изменения;
    * `replace` - "режим перезаписи": данные по переданным аптекам будут записаны поверх предыдущих данных тех же аптек, при этом данные по ранее переданным аптекам (не указанных в данном запросе) будут очищены (т.е. равноценно удалению всех остальных аптек, кроме переданных).
* `pharmacies` - массив данных по аптекам:
  * `id` - обязательное, код (идентификатор) аптеки
  * `brand` - бренд / торговая марка аптеки (название, написанное на вывеске)
  * `legal_entity` - наименование юрлица аптеки
  * `inn` - ИНН юрлица аптеки
  * `region` - регион (субъект РФ), где расположена аптека
  * `city` - город (населенный пункт), где расположена аптека
  * `address` - обязательное, полный адрес аптеки (включая регион и город)
  * `gps` - GPS-координаты аптеки, широта и долгота в долях градусов, разделитель запятая, дробная часть отделяется точкой (например: `55.779532, 37.585421`)
  * `work_time` - часы работы аптеки
  * `phones` - контактные телефоны аптеки ("публичные" - для покупателей, чтобы показывать на общедоступном сайте
  * `pos_ids` - массив идентификаторов POS-терминалов, относящихся к данной аптеке (см. примечение внизу)
  * `disabled` - признак выключения/удаления аптеки:
     * `false` (по умолчанию) - аптека активна (не отключена) и обслуживает покупателей
     * `true` - аптека выключена и не обслуживает покупателей
  * `hidden` - признак сокрытия аптеки от покупателей (с карты):
     * `false` (по умолчанию) - аптека видна на карте (если не выключена полем disabled)
     * `true` - аптека не отображается на карте, однако скидки в ней рассчитываются (полезно для "новых" аптек, которые на этапе тестов) 
   
Все перечисленные выше поля имеют строковый тип (string) за исключением полей `disabled` и `hidden`, которые имеют логический тип (boolean).

Допустимо наличие других полей со сведениями об аптеке (они будут проигнорированы сервером). 

Если в вашем файле уже присутствуют какие-то другие полезные (но не указанные выше) поля, или же присутствуют с другим именем - сообщите нам, мы попробуем подстроиться под ваш формат файла.

В случае, если в запросах помимо `pos_id` также всегда посылается `pharmacy_id` (*[подробнее здесь](/like_changes#pharmacy_id)*), то заполнение массива `pos_ids` необязательно.

В случае, если в файле есть аптеки с одинаковым (повторяющимся) `id` - будут использованы данные последней из них.

Если в файле один и тот же `pos_id` встретится в нескольких аптеках - он будет "привязан" к последней из них.



## Ответ :id=response

```json
{
    "status": "<status>",
    "error_code": <error_code>,
    "message": "<message>"
}
```

Поля в ответе:

  * `status` - текстовое, одно из двух значений: `success` (успех) или `error` (ошибка)
  * `error_code` - числовое, код ошибки (`0` если нет ошибок)
  * `message` - текстовое, сообщение описывающее значение error_code

Пример ответа:
```json
{
  "status": "success",
  "error_code": 0,
  "message": "Список из 42 аптек успешно принят"
}
```