# Метод `confirm_purchase`

Фиксирует (подтверждает) факт продажи по ранее согласованным (`get_discount`) условиям.

!> Вызов метода `confirm_purchase` возможен в течение 30 минут с момента вызова `get_discount`, после этого времени сервер будет возвращать сообщение об ошибке (подтверждение такой продажи необходимо производить через техподдержку, при этом в подтверждении мжет быть отказано если данная карта относится к лимитным тарифам и держатель карты уже "выбрал" лимит обратившись в другую аптеку).

## Запрос :id=request

Метод запроса: `POST`

Тело запроса: 
```json
{
    "pos_id": "<pos_id>",
    "pharmacy_id": "<pharmacy_id>"
    "card_number": "<card_number>",
    "phone_number": "<phone_number>",
    "transactions": [
        "<transaction_1>",
        "<transaction_2>",
        ...
    ]
}
```

Поля в запросе:

  * `pos_id` - обязательный, строковый (до 50 символов) \
Идентификатор кассового терминала (используется для идентификации аптеки в случае отсутствия параметра pharmacy_id)
  * `pharmacy_id` - необязательный но желательный (*[подробнее здесь](/like/changes#pharmacy_id)*), строковый (до 50 символов) \
Идентификатор аптеки, для которой необходимо получить список товарных позиций.
  * `card_number` - обязательный (см. примечание ниже), строковый (до 50 символов) \
Номер дисконтной карты из запроса `get_discount`
  * `phone_number` - обязательный (см. примечание ниже), строковый (до 50 символов) \
Номер телефона покупателя из запроса `get_discount`
  * `transaction_X` - обязательный, строковый \
Код подтверждения продажи из ответа метода `get_discount`

В запросе должно присутствовать ровно одно из двух полей: `card_number` или `phone_number` - ровно то что было указано при вызове `get_discount`.

!> В некоторых дисконтных программах критически важно, чтобы подтверждались все позиции со скидкой (т.е. надо подтверждать коды `transaction` из всех строк `order` где они были), и при попытке "частичного" подтверждения (например только одной строки со скидкой из двух по которым рассчиталась скидка) методом `confirm_purchase` будет возвращена ошибка. Таким образом, если покупатель после расчета скидки изменил чек (отказался от части позиций) то необходимо повторно вызвать `get_discount` для повторного расчёта скидки и получения новых кодов подтверждения, и только после этого вызывать `confirm_purchase`.

## Ответ :id=response

```json
{
    "status": "<status>",
    "error_code": <error_code>,
    "message": "<message>"
}
```

Поля в ответе:

  * `status` - текстовое, одно из двух значений: `success` (успех) или `error` (ошибка)
  * `error_code` - числовое, код ошибки (`0` если нет ошибок)
  * `message` - текстовое, сообщение описывающее значение error_code

Пример ответа:
```json
{
  "status": "success",
  "error_code": 0,
  "message": "Транзакция подтверждена"
}
```